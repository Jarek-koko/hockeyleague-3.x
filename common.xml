<?xml version="1.0" encoding="UTF-8"?>
<project>
    <property environment="env"/>
    <property name="source"     value="${env.SOURCEDIR}\joomla30" />
    <property name="release" 	value="${env.RELEASEDIR}\hockeyleague3.x\Releases" />
    <property name="builddir" 	value="${env.BUILDDIR}" />
    <property name="verbose" 	value="true" />
 
    <tstamp>
        <format property="NOW" pattern="dd-MM-yyyy" />
    </tstamp>

    <property name="version" value="${NOW}" />

    
    <target name="_clean">
        <delete dir="${builddir}/${NAME}" verbose="${verbose}"/>
    </target>
    
    <target name="_sync">
        <sync todir="${NAME}" includeemptydirs="true" failonerror="false">
            <fileset dir="${builddir}/${NAME}"/>
            <preserveintarget>
                <include name="**/.git/**"/>
            </preserveintarget>
        </sync>
    </target>
    
    
    <target name="_package">
        <zip destfile="${release}/${NAME}_${version}.zip" basedir="${NAME}" excludes=".git, README.md"/>
    </target>
    
    
    <target name="buildmodule" depends="_clean">
        
        <copy todir="${builddir}/${NAME}" overwrite="true" verbose="${verbose}" failonerror="false">
            <fileset dir="${source}/${PREFIX}/modules/${NAME}"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}" overwrite="true" verbose="${verbose}"  failonerror="false" flatten="true">
            <fileset dir="${source}/${PREFIX}/language">
                <include name="*/*${NAME}.ini" />
                <include name="*/*${NAME}.sys.ini" />
            </fileset>
        </copy>
        
    </target>
    
    <target name="buildcomponent" depends="_clean">

        <mkdir dir="${builddir}/${NAME}/site"/>
        <mkdir dir="${builddir}/${NAME}/admin"/>
        <mkdir dir="${builddir}/${NAME}/media"/>
        <mkdir dir="${builddir}/${NAME}/admin/sql"/>
        <mkdir dir="${builddir}/${NAME}/images"/>
        <mkdir dir="${builddir}/${NAME}/images/numbers"/>
        <mkdir dir="${builddir}/${NAME}/images/teams"/>
        <mkdir dir="${builddir}/${NAME}/images/players"/>
        
        <copy todir="${builddir}/${NAME}/images/numbers" overwrite="true" verbose="${verbose}" failonerror="false">
            <fileset dir="${source}/images/hockey/numbers"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}/images/teams" overwrite="true" verbose="${verbose}" failonerror="false">
            <filelist dir="${source}/images/hockey/teams" files="nologo.png" />
            <filelist dir="${source}/images/hockey/teams" files="index.html" />
        </copy>
        
        <copy todir="${builddir}/${NAME}/images/players" overwrite="true" verbose="${verbose}" failonerror="false">
            <filelist dir="${source}/images/hockey/players" files="nophoto.jpg"/>
            <filelist dir="${source}/images/hockey/players" files="index.html"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}/admin" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/administrator/components/${NAME}"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}/admin/language" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/administrator/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/*${NAME}*.ini"/>
            </fileset>
        </copy>
        
        <copy todir="${builddir}/${NAME}/media" overwrite="true" verbose="${verbose}"  failonerror="false">
            <fileset dir="${source}/media/${NAME}"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}/site" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/components/${NAME}"/>
        </copy>
        
        <copy todir="${builddir}/${NAME}/site/language" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/*${NAME}*.ini" />
            </fileset>
        </copy>
        
        <move file="${builddir}/${NAME}/admin/hockey.xml" todir="${builddir}/${NAME}" verbose="${verbose}"/>
        <move file="${builddir}/${NAME}/admin/script.php" todir="${builddir}/${NAME}" verbose="${verbose}" />
        
    </target>
</project>
